<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRD - Dashboard de Ventas Farmac√©uticas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #875A7B 0%, #6B4565 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .meta-info {
            background: #f8f9fa;
            padding: 20px 40px;
            border-bottom: 1px solid #e9ecef;
        }

        .meta-info table {
            width: 100%;
            border-collapse: collapse;
        }

        .meta-info td {
            padding: 8px;
        }

        .meta-info td:first-child {
            font-weight: bold;
            width: 200px;
            color: #875A7B;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        h2 {
            color: #875A7B;
            font-size: 1.8em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #875A7B;
        }

        h3 {
            color: #6B4565;
            font-size: 1.4em;
            margin-top: 25px;
            margin-bottom: 12px;
        }

        h4 {
            color: #875A7B;
            font-size: 1.1em;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: #f8f9fa;
            border-left: 4px solid #875A7B;
            padding: 20px;
            border-radius: 5px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(135, 90, 123, 0.3);
        }

        .feature-card h4 {
            margin-top: 0;
            color: #875A7B;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .tech-badge {
            background: #875A7B;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .user-role {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .user-role h4 {
            color: #2196F3;
            margin-top: 0;
        }

        .diagram {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
        }

        .diagram pre {
            background: white;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table th {
            background: #875A7B;
            color: white;
            padding: 12px;
            text-align: left;
        }

        table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }

        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Product Requirements Document (PRD)</h1>
            <p>Dashboard de Ventas Farmac√©uticas</p>
        </header>

        <div class="meta-info">
            <table>
                <tr>
                    <td>Nombre del Proyecto:</td>
                    <td><strong>Dashboard de Ventas Farmac√©uticas</strong></td>
                </tr>
                <tr>
                    <td>Versi√≥n:</td>
                    <td>3.1</td>
                </tr>
                <tr>
                    <td>Fecha de Creaci√≥n:</td>
                    <td>1 de diciembre de 2025</td>
                </tr>
                <tr>
                    <td>Propietario del Producto:</td>
                    <td>Jonathan Cerda</td>
                </tr>
                <tr>
                    <td>Estado:</td>
                    <td><span style="color: #28a745; font-weight: bold;">‚úÖ Producci√≥n</span></td>
                </tr>
            </table>
        </div>

        <div class="content">
            <!-- SECCI√ìN 1: RESUMEN EJECUTIVO -->
            <section class="section">
                <h2>1. Resumen Ejecutivo</h2>
                <p>
                    El <strong>Dashboard de Ventas Farmac√©uticas</strong> es una aplicaci√≥n web dise√±ada para proporcionar 
                    visibilidad en tiempo real del desempe√±o de ventas de productos farmac√©uticos a trav√©s de m√∫ltiples 
                    l√≠neas comerciales. La plataforma integra datos de Odoo ERP y Google Sheets para ofrecer an√°lisis 
                    detallados, seguimiento de metas y gesti√≥n de equipos de ventas.
                </p>

                <div class="highlight success">
                    <strong>üéØ Objetivo Principal:</strong> Centralizar y visualizar informaci√≥n cr√≠tica de ventas para 
                    facilitar la toma de decisiones estrat√©gicas y operativas del equipo comercial.
                </div>
            </section>

            <!-- SECCI√ìN 2: CONTEXTO Y PROBLEMA -->
            <section class="section">
                <h2>2. Contexto del Negocio</h2>
                
                <h3>2.1 Problema a Resolver</h3>
                <p>
                    La empresa maneja m√∫ltiples l√≠neas comerciales farmac√©uticas (Petmedica, Agrovet, Pet Nutriscience, 
                    Avivet, Genvet, Interpet, entre otras) con equipos de vendedores distribuidos. Los desaf√≠os principales incluyen:
                </p>
                <ul>
                    <li>Falta de visibilidad en tiempo real del avance de ventas vs. metas establecidas</li>
                    <li>Dificultad para analizar el rendimiento individual de vendedores por l√≠nea comercial</li>
                    <li>Datos dispersos entre diferentes sistemas (Odoo, hojas de c√°lculo)</li>
                    <li>Necesidad de identificar productos con pr√≥xima fecha de vencimiento</li>
                    <li>Seguimiento de productos nuevos (IPN - Introducci√≥n de Productos Nuevos)</li>
                    <li>An√°lisis del ciclo de vida de productos y formas farmac√©uticas</li>
                </ul>

                <h3>2.2 Soluci√≥n Propuesta</h3>
                <p>
                    Una aplicaci√≥n web centralizada que integre datos de ventas de Odoo ERP con la gesti√≥n de metas 
                    almacenada en Google Sheets, proporcionando dashboards interactivos con KPIs, gr√°ficos anal√≠ticos 
                    y capacidades de exportaci√≥n para an√°lisis detallado.
                </p>
            </section>

            <!-- SECCI√ìN 3: USUARIOS Y ROLES -->
            <section class="section">
                <h2>3. Usuarios y Roles</h2>

                <div class="user-role">
                    <h4>üë§ Usuario Est√°ndar</h4>
                    <p><strong>Acceso:</strong> Vendedores y personal operativo</p>
                    <p><strong>Permisos:</strong></p>
                    <ul>
                        <li>Ver Dashboard Principal con KPIs generales</li>
                        <li>Acceder a Dashboards por L√≠nea Comercial</li>
                        <li>Visualizar gr√°ficos y tablas de rendimiento</li>
                        <li>Filtrar informaci√≥n por mes y d√≠a</li>
                    </ul>
                </div>

                <div class="user-role" style="background: #ffe7f0; border-left-color: #dc3545;">
                    <h4 style="color: #dc3545;">üëë Administrador</h4>
                    <p><strong>Acceso:</strong> Janet Hueza y Jonathan Cerda</p>
                    <p><strong>Permisos Adicionales:</strong></p>
                    <ul>
                        <li>Acceso completo a la p√°gina de Ventas Detalladas</li>
                        <li>Configuraci√≥n de Metas mensuales por L√≠nea Comercial</li>
                        <li>Gesti√≥n de Equipos de Ventas</li>
                        <li>Asignaci√≥n de Metas individuales a Vendedores</li>
                        <li>Exportaci√≥n de datos detallados a Excel</li>
                        <li>Acceso a herramientas externas (Stock Odoo)</li>
                    </ul>
                </div>

                <h3>3.1 Autenticaci√≥n</h3>
                <p>
                    El sistema utiliza autenticaci√≥n integrada con Odoo ERP. Los usuarios deben estar registrados 
                    en la lista blanca (<code>allowed_users.json</code>) para acceder a la aplicaci√≥n.
                </p>
            </section>

            <!-- SECCI√ìN 4: CARACTER√çSTICAS Y FUNCIONALIDADES -->
            <section class="section">
                <h2>4. Caracter√≠sticas y Funcionalidades</h2>

                <h3>4.1 Dashboard Principal</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>üìä KPIs Principales</h4>
                        <ul>
                            <li>Meta Total</li>
                            <li>Venta Total</li>
                            <li>% Avance</li>
                            <li>Meta IPN</li>
                            <li>Venta IPN</li>
                            <li>% Avance IPN</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>üìà KPIs de Rendimiento</h4>
                        <ul>
                            <li>Avance Diario Acumulado</li>
                            <li>Avance Diario IPN</li>
                            <li>Ritmo Diario Requerido</li>
                            <li>Proyecci√≥n de Cierre</li>
                            <li>Faltante para Meta</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>üìã Tabla de L√≠neas Comerciales</h4>
                        <ul>
                            <li>Meta vs. Venta por l√≠nea</li>
                            <li>% Cumplimiento</li>
                            <li>% sobre Total de Ventas</li>
                            <li>Meta y Venta IPN</li>
                            <li>Productos con Vencimiento &lt;6 meses</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>üìä Gr√°ficos Anal√≠ticos</h4>
                        <ul>
                            <li>Top 7 Productos por Ventas</li>
                            <li>Ventas por Ciclo de Vida</li>
                            <li>Equipo ECOMMERCE (desglose por l√≠nea)</li>
                        </ul>
                    </div>
                </div>

                <h3>4.2 Dashboard por L√≠nea Comercial</h3>
                <p>Dashboard detallado para cada l√≠nea comercial con los siguientes componentes:</p>
                <ul>
                    <li><strong>Tabla de Vendedores:</strong> Rendimiento individual con metas, ventas, IPN y vencimientos</li>
                    <li><strong>Gr√°fico Meta vs. Venta:</strong> Comparaci√≥n visual del desempe√±o de cada vendedor</li>
                    <li><strong>Top 7 Productos:</strong> Productos m√°s vendidos de la l√≠nea</li>
                    <li><strong>Ventas por Ciclo de Vida:</strong> Distribuci√≥n entre productos nuevos, maduros y otros</li>
                    <li><strong>Ventas por Forma Farmac√©utica:</strong> An√°lisis por presentaci√≥n del producto</li>
                </ul>

                <div class="highlight info">
                    <strong>‚ÑπÔ∏è Nota:</strong> Los dashboards incluyen un manejo especial para "Ajustes y Notas de Cr√©dito" 
                    que no est√°n asignados a un vendedor espec√≠fico, asegurando la precisi√≥n de los totales.
                </div>

                <h3>4.3 Gesti√≥n de Ventas (Solo Administradores)</h3>
                <div class="feature-card">
                    <h4>üîç Vista Detallada de Ventas</h4>
                    <ul>
                        <li>Filtros por fecha (desde/hasta)</li>
                        <li>B√∫squeda por t√©rmino</li>
                        <li>Visualizaci√≥n de todas las l√≠neas de venta con detalles completos</li>
                        <li>Informaci√≥n de cliente, producto, vendedor, l√≠nea comercial, etc.</li>
                        <li>Exclusi√≥n autom√°tica de Ventas Internacionales (exportaciones)</li>
                    </ul>
                </div>

                <h3>4.4 Gesti√≥n de Metas (Solo Administradores)</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>üéØ Metas por L√≠nea Comercial</h4>
                        <ul>
                            <li>Definici√≥n de metas mensuales totales</li>
                            <li>Definici√≥n de metas IPN</li>
                            <li>Configuraci√≥n para equipo ECOMMERCE</li>
                            <li>Historial de metas por mes</li>
                            <li>Visualizaci√≥n de metas totales</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>üë• Metas por Vendedor</h4>
                        <ul>
                            <li>Asignaci√≥n de vendedores a equipos</li>
                            <li>Tabla din√°mica anual para metas individuales</li>
                            <li>Metas totales e IPN por vendedor</li>
                            <li>Selector multi-vendedor con b√∫squeda</li>
                            <li>Formateo autom√°tico de n√∫meros</li>
                        </ul>
                    </div>
                </div>

                <h3>4.5 Exportaci√≥n de Datos (Solo Administradores)</h3>
                <ul>
                    <li><strong>Exportar Detalle del Dashboard:</strong> Genera un archivo Excel formateado con todas las l√≠neas de venta del mes seleccionado</li>
                    <li><strong>Caracter√≠sticas de la exportaci√≥n:</strong>
                        <ul>
                            <li>Columnas traducidas al espa√±ol</li>
                            <li>Formato de moneda (S/)</li>
                            <li>Formato de fecha (YYYY-MM-DD)</li>
                            <li>Encabezados con estilo</li>
                            <li>Ancho de columnas optimizado</li>
                            <li>Panel superior congelado</li>
                        </ul>
                    </li>
                </ul>

                <h3>4.6 Filtros y Navegaci√≥n</h3>
                <ul>
                    <li><strong>Filtro por Mes:</strong> Selector de meses del a√±o actual</li>
                    <li><strong>Filtro por D√≠a:</strong> Permite analizar el rendimiento hasta un d√≠a espec√≠fico del mes</li>
                    <li><strong>Navegaci√≥n entre L√≠neas:</strong> Enlaces directos desde el dashboard principal a dashboards espec√≠ficos de l√≠nea</li>
                    <li><strong>Filtro por L√≠nea Comercial:</strong> Selector en el dashboard de l√≠nea</li>
                </ul>
            </section>

            <!-- SECCI√ìN 5: ARQUITECTURA T√âCNICA -->
            <section class="section">
                <h2>5. Arquitectura T√©cnica</h2>

                <h3>5.1 Stack Tecnol√≥gico</h3>
                <div class="tech-stack">
                    <span class="tech-badge">Python 3.x</span>
                    <span class="tech-badge">Flask 3.1.1</span>
                    <span class="tech-badge">Odoo ERP (XML-RPC)</span>
                    <span class="tech-badge">Google Sheets API</span>
                    <span class="tech-badge">Pandas 2.3.1</span>
                    <span class="tech-badge">Openpyxl 3.1.5</span>
                    <span class="tech-badge">Gspread 6.2.1</span>
                    <span class="tech-badge">Gunicorn 23.0.0</span>
                    <span class="tech-badge">HTML5/CSS3</span>
                    <span class="tech-badge">JavaScript (ECharts)</span>
                </div>

                <h3>5.2 Componentes del Sistema</h3>
                <div class="diagram">
                    <pre>
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      DASHBOARD WEB APP                       ‚îÇ
‚îÇ                      (Flask + Gunicorn)                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ                              ‚îÇ
               ‚ñº                              ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   OdooManager    ‚îÇ          ‚îÇ GoogleSheetsManager ‚îÇ
    ‚îÇ  (XML-RPC API)   ‚îÇ          ‚îÇ  (gspread API)      ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ                              ‚îÇ
             ‚ñº                              ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   Odoo ERP      ‚îÇ          ‚îÇ  Google Sheets   ‚îÇ
    ‚îÇ  (PostgreSQL)   ‚îÇ          ‚îÇ  (Metas/Equipos) ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    </pre>
                </div>

                <h3>5.3 M√≥dulos Principales</h3>
                <table>
                    <thead>
                        <tr>
                            <th>M√≥dulo</th>
                            <th>Responsabilidad</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>app.py</code></td>
                            <td>Aplicaci√≥n principal Flask, rutas, controladores y l√≥gica de negocio</td>
                        </tr>
                        <tr>
                            <td><code>odoo_manager.py</code></td>
                            <td>Conexi√≥n con Odoo ERP, autenticaci√≥n de usuarios, extracci√≥n de datos de ventas</td>
                        </tr>
                        <tr>
                            <td><code>google_sheets_manager.py</code></td>
                            <td>Gesti√≥n de metas y equipos en Google Sheets (lectura/escritura)</td>
                        </tr>
                        <tr>
                            <td><code>templates/</code></td>
                            <td>Plantillas HTML con Jinja2 para la interfaz de usuario</td>
                        </tr>
                        <tr>
                            <td><code>static/</code></td>
                            <td>CSS y JavaScript para estilos y gr√°ficos interactivos</td>
                        </tr>
                    </tbody>
                </table>

                <h3>5.4 Integraciones</h3>
                
                <h4>Odoo ERP (XML-RPC)</h4>
                <ul>
                    <li>Autenticaci√≥n de usuarios contra la base de datos de Odoo</li>
                    <li>Extracci√≥n de l√≠neas de venta con m√∫ltiples filtros</li>
                    <li>Obtenci√≥n de lista de vendedores</li>
                    <li>Consulta de datos de productos, clientes, l√≠neas comerciales</li>
                </ul>

                <h4>Google Sheets API</h4>
                <ul>
                    <li>Almacenamiento de metas por l√≠nea comercial (pesta√±as mensuales)</li>
                    <li>Gesti√≥n de equipos de ventas (pesta√±a "Equipos")</li>
                    <li>Metas individuales de vendedores (estructura pivot por equipo/vendedor/mes)</li>
                    <li>Sincronizaci√≥n bidireccional (lectura y escritura)</li>
                </ul>

                <h3>5.5 Seguridad</h3>
                <ul>
                    <li><strong>Autenticaci√≥n:</strong> Integrada con Odoo ERP</li>
                    <li><strong>Lista Blanca:</strong> Control de acceso mediante <code>allowed_users.json</code></li>
                    <li><strong>Sesiones:</strong> Gesti√≥n de sesiones con Flask (SECRET_KEY en variables de entorno)</li>
                    <li><strong>Control de Acceso Basado en Roles:</strong> Verificaci√≥n de permisos de administrador en rutas sensibles</li>
                    <li><strong>Variables de Entorno:</strong> Credenciales y configuraci√≥n sensible en archivo <code>.env</code></li>
                </ul>
            </section>

            <!-- SECCI√ìN 6: FLUJOS DE USUARIO -->
            <section class="section">
                <h2>6. Flujos de Usuario</h2>

                <h3>6.1 Flujo de Login y Visualizaci√≥n (Usuario Est√°ndar)</h3>
                <div class="diagram">
                    <pre>
1. Usuario accede a la aplicaci√≥n
   ‚Üì
2. P√°gina de Login
   ‚Üì
3. Ingresa credenciales (Email Odoo + Password)
   ‚Üì
4. Sistema verifica contra Odoo ERP
   ‚Üì
5. Sistema valida que el usuario est√© en allowed_users.json
   ‚Üì
6. ‚úÖ Redirige al Dashboard Principal
   ‚Üì
7. Usuario selecciona mes/d√≠a para an√°lisis
   ‚Üì
8. Usuario navega a Dashboard de L√≠nea espec√≠fica
   ‚Üì
9. Usuario revisa KPIs, gr√°ficos y tablas
                    </pre>
                </div>

                <h3>6.2 Flujo de Configuraci√≥n de Metas (Administrador)</h3>
                <div class="diagram">
                    <pre>
1. Administrador accede a "Metas"
   ‚Üì
2. Selecciona el mes a configurar
   ‚Üì
3. Ingresa metas totales e IPN por l√≠nea comercial
   ‚Üì
4. Incluye meta para equipo ECOMMERCE
   ‚Üì
5. Guarda metas ‚Üí Se escriben en Google Sheets
   ‚Üì
6. Sistema actualiza dashboards autom√°ticamente
   ‚Üì
7. Administrador accede a "Metas Vendedor"
   ‚Üì
8. Asigna vendedores a equipos (selector multi-vendedor)
   ‚Üì
9. Guarda equipos ‚Üí Se escriben en Google Sheets (pesta√±a "Equipos")
   ‚Üì
10. Configura metas individuales por vendedor y mes (tabla anual)
    ‚Üì
11. Guarda metas de vendedores ‚Üí Se escriben en Google Sheets
    ‚Üì
12. Dashboard de L√≠nea refleja las metas individuales
                    </pre>
                </div>

                <h3>6.3 Flujo de Exportaci√≥n (Administrador)</h3>
                <div class="diagram">
                    <pre>
1. Administrador en Dashboard Principal
   ‚Üì
2. Selecciona mes y d√≠a (opcional)
   ‚Üì
3. Click en "Exportar Detalle"
   ‚Üì
4. Sistema consulta Odoo ERP (l√≠mite: 10,000 registros)
   ‚Üì
5. Filtra ventas internacionales
   ‚Üì
6. Procesa datos y formatea para Excel
   ‚Üì
7. Genera archivo .xlsx con estilos
   ‚Üì
8. Descarga archivo: detalle_ventas_YYYY-MM.xlsx
                    </pre>
                </div>
            </section>

            <!-- SECCI√ìN 7: REGLAS DE NEGOCIO -->
            <section class="section">
                <h2>7. Reglas de Negocio</h2>

                <h3>7.1 C√°lculo de M√©tricas</h3>
                <table>
                    <thead>
                        <tr>
                            <th>M√©trica</th>
                            <th>F√≥rmula</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>% Avance</td>
                            <td>(Venta Total / Meta Total) √ó 100</td>
                        </tr>
                        <tr>
                            <td>% Avance IPN</td>
                            <td>(Venta IPN / Meta IPN) √ó 100</td>
                        </tr>
                        <tr>
                            <td>Avance Diario Acumulado</td>
                            <td>(% Avance Total / D√≠a Actual del Mes)</td>
                        </tr>
                        <tr>
                            <td>Ritmo Diario Requerido</td>
                            <td>(100% - % Avance Actual) / D√≠as Laborables Restantes</td>
                        </tr>
                        <tr>
                            <td>Proyecci√≥n Lineal</td>
                            <td>(Venta Actual / D√≠a Actual) √ó D√≠as Totales del Mes</td>
                        </tr>
                        <tr>
                            <td>Faltante para Meta</td>
                            <td>max(Meta Total - Venta Total, 0)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>7.2 Filtros y Exclusiones</h3>
                <ul>
                    <li><strong>Ventas Internacionales:</strong> Se excluyen autom√°ticamente las ventas marcadas como "VENTA INTERNACIONAL" o del canal "INTERNACIONAL"</li>
                    <li><strong>D√≠as Laborables:</strong> Se consideran de Lunes a S√°bado (excluyendo Domingo)</li>
                    <li><strong>Productos con Vencimiento:</strong> Se identifican productos con <code>route_id</code> en [18, 19] (rutas de vencimiento &lt;6 meses)</li>
                    <li><strong>Productos Nuevos (IPN):</strong> Se consideran productos con <code>product_life_cycle = 'nuevo'</code></li>
                </ul>

                <h3>7.3 Limpieza de Datos</h3>
                <div class="highlight">
                    <strong>üîß Normalizaci√≥n de Productos ATREVIA:</strong> Los productos de la l√≠nea ATREVIA se agrupan 
                    eliminando los indicadores de tama√±o/presentaci√≥n (MEDIUM, LARGE, SMALL, etc.) para consolidar 
                    las ventas por producto base.
                </div>
                <p><strong>Ejemplos:</strong></p>
                <ul>
                    <li>ATREVIA ONE MEDIUM ‚Üí ATREVIA ONE</li>
                    <li>ATREVIA XR LARGE ‚Üí ATREVIA XR</li>
                    <li>ATREVIA TRIO CATS SPOT ON MEDIUM ‚Üí ATREVIA TRIO CATS</li>
                </ul>

                <h3>7.4 Gesti√≥n de Ajustes</h3>
                <ul>
                    <li>Las <strong>Notas de Cr√©dito</strong> sin vendedor asignado se agrupan en una fila especial "Ajustes y Notas de Cr√©dito"</li>
                    <li>Los ajustes se suman al total de ventas de la l√≠nea para mantener consistencia contable</li>
                    <li>Los vendedores con ventas negativas (solo notas de cr√©dito) se excluyen de la tabla, pero su impacto se refleja en el total</li>
                </ul>
            </section>

            <!-- SECCI√ìN 8: CONSIDERACIONES DE DESPLIEGUE -->
            <section class="section">
                <h2>8. Despliegue y Configuraci√≥n</h2>

                <h3>8.1 Requisitos del Sistema</h3>
                <ul>
                    <li>Python 3.9 o superior</li>
                    <li>Conexi√≥n a Odoo ERP (URL, base de datos, credenciales)</li>
                    <li>Cuenta de servicio de Google Cloud con acceso a Google Sheets API</li>
                    <li>Servidor web compatible con Gunicorn (Linux/Unix)</li>
                </ul>

                <h3>8.2 Variables de Entorno (.env)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Variable</th>
                            <th>Descripci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>SECRET_KEY</code></td>
                            <td>Clave secreta para sesiones de Flask</td>
                        </tr>
                        <tr>
                            <td><code>ODOO_URL</code></td>
                            <td>URL del servidor Odoo</td>
                        </tr>
                        <tr>
                            <td><code>ODOO_DB</code></td>
                            <td>Nombre de la base de datos Odoo</td>
                        </tr>
                        <tr>
                            <td><code>GOOGLE_SHEET_NAME</code></td>
                            <td>Nombre de la hoja de Google Sheets para metas</td>
                        </tr>
                    </tbody>
                </table>

                <h3>8.3 Archivos de Configuraci√≥n</h3>
                <ul>
                    <li><code>credentials.json</code>: Credenciales de la cuenta de servicio de Google Cloud</li>
                    <li><code>allowed_users.json</code>: Lista blanca de usuarios autorizados</li>
                    <li><code>requirements.txt</code>: Dependencias de Python</li>
                </ul>

                <h3>8.4 Estructura de Google Sheets</h3>
                <p>La hoja de c√°lculo debe contener las siguientes pesta√±as:</p>
                <ul>
                    <li><strong>Equipos:</strong> Columnas <code>equipo_id | vendedor_id | vendedor_nombre</code></li>
                    <li><strong>Metas Vendedores:</strong> Estructura pivot <code>equipo_id | vendedor_id | mes | meta | meta_ipn</code></li>
                    <li><strong>Meses (YYYY-MM):</strong> Una pesta√±a por mes con columnas <code>linea_id | meta | meta_ipn</code></li>
                </ul>

                <h3>8.5 Comando de Inicio</h3>
                <div class="diagram">
                    <pre>
# Desarrollo
python app.py

# Producci√≥n (Gunicorn)
gunicorn -w 4 -b 0.0.0.0:5000 app:app
                    </pre>
                </div>
            </section>

            <!-- SECCI√ìN 9: ROADMAP Y MEJORAS FUTURAS -->
            <section class="section">
                <h2>9. Roadmap y Mejoras Futuras</h2>

                <h3>9.1 Versi√≥n 4.0 (Propuesta)</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>üì± Responsive Design</h4>
                        <p>Optimizaci√≥n completa para dispositivos m√≥viles y tablets</p>
                    </div>

                    <div class="feature-card">
                        <h4>üîî Notificaciones</h4>
                        <p>Alertas autom√°ticas cuando el avance est√° por debajo del objetivo</p>
                    </div>

                    <div class="feature-card">
                        <h4>üìä Dashboards Personalizados</h4>
                        <p>Permitir a los usuarios crear y guardar vistas personalizadas</p>
                    </div>

                    <div class="feature-card">
                        <h4>ü§ñ Machine Learning</h4>
                        <p>Predicciones de ventas basadas en hist√≥rico y tendencias</p>
                    </div>

                    <div class="feature-card">
                        <h4>üìà An√°lisis de Tendencias</h4>
                        <p>Gr√°ficos de comparaci√≥n a√±o contra a√±o y proyecciones</p>
                    </div>

                    <div class="feature-card">
                        <h4>üîó API REST</h4>
                        <p>Endpoints para integraci√≥n con otras aplicaciones</p>
                    </div>
                </div>

                <h3>9.2 Mejoras de Corto Plazo</h3>
                <ul>
                    <li>Implementar cach√© de datos para mejorar tiempos de carga</li>
                    <li>Agregar filtros adicionales (por vendedor, por producto, por cliente)</li>
                    <li>Exportaci√≥n de gr√°ficos a imagen (PNG/SVG)</li>
                    <li>Comparaci√≥n de rendimiento entre l√≠neas comerciales</li>
                    <li>Dashboard espec√≠fico para el equipo ECOMMERCE con m√°s detalle</li>
                </ul>

                <h3>9.3 Optimizaciones T√©cnicas</h3>
                <ul>
                    <li>Implementar lazy loading para datos pesados</li>
                    <li>Migrar a base de datos local (PostgreSQL) para reducir dependencia de Odoo en consultas frecuentes</li>
                    <li>Implementar sistema de jobs as√≠ncronos para exportaciones grandes</li>
                    <li>Agregar tests unitarios y de integraci√≥n</li>
                    <li>Documentaci√≥n autom√°tica de API con Swagger</li>
                </ul>
            </section>

            <!-- SECCI√ìN 10: M√âTRICAS DE √âXITO -->
            <section class="section">
                <h2>10. M√©tricas de √âxito</h2>

                <h3>10.1 KPIs del Producto</h3>
                <table>
                    <thead>
                        <tr>
                            <th>M√©trica</th>
                            <th>Objetivo</th>
                            <th>Frecuencia</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Usuarios Activos Diarios (DAU)</td>
                            <td>&gt; 80% de usuarios autorizados</td>
                            <td>Diaria</td>
                        </tr>
                        <tr>
                            <td>Tiempo de Carga del Dashboard</td>
                            <td>&lt; 3 segundos</td>
                            <td>Continua</td>
                        </tr>
                        <tr>
                            <td>Uptime de la Aplicaci√≥n</td>
                            <td>&gt; 99.5%</td>
                            <td>Mensual</td>
                        </tr>
                        <tr>
                            <td>Exportaciones Exitosas</td>
                            <td>&gt; 95%</td>
                            <td>Semanal</td>
                        </tr>
                        <tr>
                            <td>Errores de Sincronizaci√≥n (Sheets/Odoo)</td>
                            <td>&lt; 1%</td>
                            <td>Diaria</td>
                        </tr>
                    </tbody>
                </table>

                <h3>10.2 Impacto en el Negocio</h3>
                <ul>
                    <li>Reducci√≥n del tiempo de an√°lisis de ventas en un 70%</li>
                    <li>Visibilidad en tiempo real del avance vs. meta</li>
                    <li>Mejora en la toma de decisiones estrat√©gicas del equipo comercial</li>
                    <li>Identificaci√≥n temprana de productos con pr√≥xima fecha de vencimiento</li>
                    <li>Seguimiento efectivo del lanzamiento de productos nuevos (IPN)</li>
                </ul>
            </section>

            <!-- SECCI√ìN 11: ANEXOS -->
            <section class="section">
                <h2>11. Anexos</h2>

                <h3>11.1 L√≠neas Comerciales Soportadas</h3>
                <div class="tech-stack">
                    <span class="tech-badge" style="background: #e74c3c;">PETMEDICA</span>
                    <span class="tech-badge" style="background: #3498db;">AGROVET</span>
                    <span class="tech-badge" style="background: #2ecc71;">PET NUTRISCIENCE</span>
                    <span class="tech-badge" style="background: #f39c12;">AVIVET</span>
                    <span class="tech-badge" style="background: #9b59b6;">GENVET</span>
                    <span class="tech-badge" style="background: #1abc9c;">INTERPET</span>
                    <span class="tech-badge" style="background: #34495e;">OTROS</span>
                    <span class="tech-badge" style="background: #e67e22;">ECOMMERCE</span>
                </div>

                <h3>11.2 Campos de Datos de Odoo</h3>
                <p>Principales campos utilizados del modelo <code>account.move.line</code>:</p>
                <ul>
                    <li><code>invoice_date</code>: Fecha de factura</li>
                    <li><code>move_name</code>: N√∫mero de documento</li>
                    <li><code>partner_name</code>: Nombre del cliente</li>
                    <li><code>invoice_user_id</code>: Vendedor</li>
                    <li><code>name</code>: Descripci√≥n del producto</li>
                    <li><code>quantity</code>: Cantidad vendida</li>
                    <li><code>balance</code>: Importe total</li>
                    <li><code>commercial_line_national_id</code>: L√≠nea comercial</li>
                    <li><code>product_life_cycle</code>: Ciclo de vida del producto</li>
                    <li><code>route_id</code>: Ruta de venta (para identificar vencimientos)</li>
                    <li><code>pharmaceutical_forms_id</code>: Forma farmac√©utica</li>
                    <li><code>sales_channel_id</code>: Canal de ventas</li>
                </ul>

                <h3>11.3 Historial de Versiones</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Versi√≥n</th>
                            <th>Fecha</th>
                            <th>Cambios Principales</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1.0</td>
                            <td>Q2 2024</td>
                            <td>Dashboard inicial con conexi√≥n a Odoo, KPIs b√°sicos y gesti√≥n de metas por l√≠nea</td>
                        </tr>
                        <tr>
                            <td>2.0</td>
                            <td>Q3 2024</td>
                            <td>Dashboard por vendedor, gesti√≥n de equipos y metas individuales</td>
                        </tr>
                        <tr>
                            <td>3.0</td>
                            <td>Q4 2024</td>
                            <td>Integraci√≥n con Google Sheets, gr√°ficos mejorados, preparaci√≥n para despliegue</td>
                        </tr>
                        <tr>
                            <td>3.1</td>
                            <td>Dic 2024</td>
                            <td>Optimizaci√≥n de flujos de usuario, control de acceso por roles, mejoras de UI</td>
                        </tr>
                    </tbody>
                </table>
            </section>

        </div>

        <footer>
            <p>&copy; 2025 Dashboard de Ventas Farmac√©uticas | Versi√≥n 3.1</p>
            <p style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">
                Documento generado autom√°ticamente | √öltima actualizaci√≥n: 1 de diciembre de 2025
            </p>
        </footer>
    </div>
</body>
</html>