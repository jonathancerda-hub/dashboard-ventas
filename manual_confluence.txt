h1. üìñ Manual Interactivo - Dashboard de Ventas

{toc}

{anchor:introduccion}
h1. Introducci√≥n al Dashboard de Ventas
Este manual describe el funcionamiento del Dashboard de Ventas, explicando c√≥mo se obtienen, procesan y visualizan los datos desde el sistema Odoo. El objetivo es proporcionar una herramienta clara y precisa para el seguimiento del avance de ventas.

{anchor:obtencion-datos}
h2. 1. Obtenci√≥n de Datos (desde Odoo)
La aplicaci√≥n se conecta a Odoo para consultar las l√≠neas de asientos contables ({{account.move.line}}). Estos datos iniciales se enriquecen con informaci√≥n de otros modelos relacionados para obtener una vista completa de cada transacci√≥n.
* *Asientos Contables ({panel}account.move{panel}):* Fecha, estado, vendedor, etc.
* *Productos ({panel}product.product{panel}):* Nombre, l√≠nea comercial, ciclo de vida, etc.
* *Clientes ({panel}res.partner{panel}):* Nombre, NIF/RUC.
* *√ìrdenes de Venta ({panel}sale.order{panel}):* Origen, observaciones de entrega.

{anchor:filtros-odoo}
h2. 2. Filtros Aplicados en la Consulta a Odoo
Para asegurar que solo se procesen datos relevantes, se aplican los siguientes filtros directamente en la consulta a la base de datos de Odoo:

{panel:title=Filtros en la Consulta}
*Tipo de Movimiento:* Solo facturas de venta y notas de cr√©dito ({{out_invoice}}, {{out_refund}}).
*Estado del Movimiento:* Solo asientos contables ya publicados ({{state = 'posted'}}).
*C√≥digo de Producto:* Se excluyen productos que no tienen una referencia interna ({{default_code != False}}).
*Categor√≠as Excluidas:* Se omiten productos de categor√≠as espec√≠ficas de servicio o internas (IDs: {{[315, 333, 304, 314, 318, 339]}}).
*Impuestos:* Solo se incluyen l√≠neas que tengan aplicados los impuestos "IGV" o "IGV_INC".
{panel}

{anchor:logica-app}
h2. 3. Procesamiento y L√≥gica de Negocio (en la Aplicaci√≥n)
Una vez que los datos son obtenidos de Odoo, la aplicaci√≥n Flask aplica una serie de reglas de negocio para prepararlos antes de mostrarlos en el dashboard.

{anchor:logica-inversion}
h3. 3.1 Inversi√≥n del Saldo ({{balance}})
El campo {{balance}} de Odoo se multiplica por -1. Esto es crucial para la correcta interpretaci√≥n de los datos:
* Las *ventas*, que en contabilidad son un saldo negativo, se convierten en *positivas*.
* Las *notas de cr√©dito*, que son un saldo positivo, se convierten en *negativas*.

{note}
*Importante:* Gracias a este paso, el resto de la aplicaci√≥n trabaja con n√∫meros intuitivos y no necesita aplicar la funci√≥n {{abs()}}.
{note}

{anchor:logica-exclusion}
h3. 3.2 Exclusi√≥n de Ventas Internacionales
Se descartan todas las l√≠neas de venta que pertenecen a operaciones internacionales para enfocar el an√°lisis en el mercado local. El filtro se aplica si:
* La l√≠nea comercial ({{commercial_line_national_id}}) contiene "VENTA INTERNACIONAL".
* El canal de venta ({{sales_channel_id}}) contiene "VENTA INTERNACIONAL" o "INTERNACIONAL".

{anchor:logica-agrupacion}
h3. 3.3 Agrupaci√≥n de Datos
Finalmente, los datos ya filtrados y procesados se agrupan para alimentar los diferentes componentes visuales del dashboard. Los c√°lculos m√°s importantes son:

{panel}
* *Venta Total:* Suma del {{balance}} de todas las ventas filtradas.
* *Venta IPN (Productos Nuevos):* Suma del {{balance}} de las ventas de productos cuyo "Ciclo de vida del producto" es exactamente {{'nuevo'}}.
* *Vencimiento < 6 Meses:* Suma del {{balance}} de las ventas cuya "Ruta" en la l√≠nea de pedido tiene el ID {{18}} ('3 > P < 6') o {{19}} ('1 ‚â• P ‚â§ 3').
{panel}

{anchor:dashboard}
h2. 4. Uso del Dashboard
El dashboard principal es la primera p√°gina que ver√°s despu√©s de iniciar sesi√≥n. Permite visualizar el avance de ventas de un mes espec√≠fico. Puedes cambiar de mes usando el selector en la parte superior y los KPIs y gr√°ficos se actualizar√°n autom√°ticamente.
* *Personalizaci√≥n:* El nombre del usuario que ha iniciado sesi√≥n se muestra debajo del t√≠tulo principal para una experiencia m√°s personal.
* *Navegaci√≥n:* Desde aqu√≠ puedes acceder a las dem√°s secciones como "Ventas", "Metas por L√≠nea" y "Metas por Vendedor".
* *Exportaci√≥n:* Puedes exportar el detalle completo de los datos del mes seleccionado a un archivo Excel.

{anchor:dashboard-interactivo}
h3. 4.1 Gr√°ficos Interactivos y An√°lisis Jer√°rquico
El dashboard principal ahora incluye gr√°ficos din√°micos que est√°n conectados entre s√≠ para un an√°lisis m√°s profundo:
* *An√°lisis Jer√°rquico de Ventas:* Este gr√°fico de barras te permite "profundizar" en tus datos. Al hacer clic en una barra (ej. una clasificaci√≥n farmacol√≥gica), el gr√°fico se actualizar√° para mostrar el siguiente nivel de detalle (ej. las v√≠as de administraci√≥n para esa clasificaci√≥n). Puedes usar el bot√≥n "Volver" dentro del gr√°fico para regresar al nivel anterior.
* *Gr√°ficos Conectados:* A medida que navegas por el gr√°fico jer√°rquico, los gr√°ficos *"Top 7 Productos M√°s Vendidos"* y *"Venta por Clasificaci√≥n Farmacol√≥gica"* se actualizar√°n autom√°ticamente para mostrar los datos correspondientes al nivel que est√°s visualizando. Esto te permite ver, por ejemplo, cu√°les son los productos m√°s vendidos de una v√≠a de administraci√≥n espec√≠fica dentro de una clasificaci√≥n farmacol√≥gica.

{note}
Esta funcionalidad convierte el dashboard en una herramienta de exploraci√≥n de datos, permiti√©ndote descubrir patrones y tendencias de forma intuitiva.
{note}

{anchor:dashboard-apilado}
h3. 4.2 Gr√°fico de Ventas por Clasificaci√≥n Comercial
Este nuevo gr√°fico de barras apiladas te permite analizar la composici√≥n de las ventas de cada l√≠nea comercial seg√∫n diferentes criterios.
* *Eje Vertical (Y):* Muestra las principales l√≠neas comerciales (Petmedica, Agrovet, etc.).
* *Eje Horizontal (X):* Representa el total de ventas.
* *Barras Apiladas:* Cada barra de una l√≠nea comercial est√° segmentada por colores, donde cada color representa una subcategor√≠a.

h4. Uso del Selector de Dimensi√≥n
En la esquina superior derecha del gr√°fico encontrar√°s un men√∫ desplegable. Este men√∫ te permite cambiar din√°micamente la dimensi√≥n por la cual se apilan las barras. Puedes elegir entre:
* Forma Farmac√©utica
* Clasificaci√≥n Farmacologica
* V√≠a de Administraci√≥n
* Categor√≠a de Producto
* L√≠nea de Producci√≥n

{note}
Al seleccionar una nueva dimensi√≥n, el gr√°fico se redibujar√° autom√°ticamente para reflejar la nueva estructura de datos, permiti√©ndote un an√°lisis flexible y detallado de la composici√≥n de las ventas.
{note}

{anchor:metas}
h2. 5. Gesti√≥n de Metas
La aplicaci√≥n centraliza toda la gesti√≥n de metas y equipos en una *√∫nica hoja de c√°lculo de Google Sheets*, la cual se administra a trav√©s de dos interfaces en la aplicaci√≥n web. Esto permite una gesti√≥n de datos centralizada y colaborativa.

h3. Metas por L√≠nea
Esta secci√≥n te permite establecer los objetivos de venta *generales* para cada l√≠nea comercial para un mes espec√≠fico. Estos valores son los que se usan en el dashboard principal para calcular los porcentajes de avance globales. Los datos se guardan en la pesta√±a {{MetasPorLinea}} de tu Google Sheet.

h3. Metas Vendedor (Gesti√≥n de Metas y Equipos)
Esta es la secci√≥n principal para la gesti√≥n detallada. Aqu√≠ puedes organizar a tus vendedores en equipos y asignarles metas individuales para cada mes del a√±o en una vista de tabla din√°mica. Los datos se guardan en las pesta√±as {{Equipos}} y {{Metas}} de tu Google Sheet, donde cada vendedor asignado a un equipo tiene su propia fila para mayor claridad.
* *Asignar Vendedores:* Usa el selector "Asignar Vendedores" para a√±adir o quitar miembros de un equipo. Luego, presiona el bot√≥n *"Actualizar Miembros"*. Esta acci√≥n guarda la nueva lista de integrantes en Google Sheets y recarga la p√°gina para que puedas ver las filas de los nuevos vendedores y asignarles sus metas.
* *Ingresar Metas:* En la tabla, puedes ingresar la "Meta" total y la meta "IPN" para cada vendedor en la celda correspondiente a cada mes. Los campos num√©ricos aceptan separadores de miles para facilitar la lectura.
* *Guardar Cambios:* Una vez que hayas ingresado todas las metas, presiona el bot√≥n *"Guardar Todas las Metas y Equipos"* al final de la p√°gina para almacenar todos los cambios en Google Sheets.

{note}
*Importante:* Toda la informaci√≥n de metas y equipos ahora reside en tu Google Sheet, eliminando la necesidad de archivos {{.json}} locales para esta tarea.
{note}

{anchor:dashboard-vendedor}
h2. 6. Dashboard por Vendedor
Al hacer clic en una l√≠nea comercial en la tabla del dashboard principal, se accede a una vista detallada centrada en el rendimiento de los vendedores para esa l√≠nea espec√≠fica.
* *Filtros Din√°micos:* Puedes cambiar de mes y de l√≠nea comercial directamente desde esta vista.
* *Tabla de Avance por Vendedor:* Muestra un desglose del rendimiento de cada vendedor, incluyendo su meta, venta, avance IPN y la columna de "Vencimiento < 6 Meses".
* *Gr√°ficos Comparativos:* Incluye un gr√°fico de barras "Meta vs. Venta por Vendedor" para un an√°lisis visual r√°pido del cumplimiento de objetivos.

{anchor:vista-ventas}
h2. 7. Vista de L√≠neas de Venta
La p√°gina de "Ventas" ha sido optimizada para ser m√°s r√°pida y f√°cil de usar.
* *Carga R√°pida:* La p√°gina ya no carga datos al entrar. La tabla aparecer√° vac√≠a inicialmente, garantizando una carga instant√°nea.
* *B√∫squeda a Demanda:* Los datos se obtienen √∫nicamente cuando presionas el bot√≥n *"Buscar"*.
* *B√∫squeda sin Filtros:* Si haces clic en "Buscar" sin especificar un rango de fechas, la tabla mostrar√° autom√°ticamente los datos de los √∫ltimos 30 d√≠as.
* *Filtros Simplificados:* Se ha eliminado el filtro por cliente para simplificar la interfaz y centrarse en los filtros m√°s importantes (fechas y l√≠nea comercial).